<!DOCTYPE html>
<html lang="en">
<head>
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
            href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
            rel="stylesheet"
    />
    <!-- MDB -->
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.min.css"
            rel="stylesheet"
    />
    <!-- d3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"
            integrity="sha512-M7nHCiNUOwFt6Us3r8alutZLm9qMt4s9951uo8jqO4UwJ1hziseL6O3ndFyigx6+LREfZqnhHxYjKRJ8ZQ69DQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .map {
            width: 45%;
            height: 45%;
            float: right;
            clear: right;
            margin-right: 5%
        }

        .tab {
            width: 45%;
            height: 100%;
            float: left;
            clear: left;
            padding: 0;
            margin-left: 5%;
        }
    </style>
    <title>Memphis Poverty and Race</title>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand" href="https://www.gmbs-consulting.com/">GMBS Consulting</a>
        <button
                data-mdb-collapse-init
                class="navbar-toggler"
                type="button"
                data-mdb-target="#navbarNav"
                aria-controls="navbarNav"
                aria-expanded="false"
                aria-label="Toggle navigation"
        >
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="../index.html" data-text="home">home</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-text="archives">archives</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-text="tags">tags</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-text="categories">categories</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-text="about">about</a></li>
                <li class="nav-item"><a class="nav-link" href="./Table_1.html">Table 1</a></li>
                <li class="nav-item"><a class="nav-link" href="./Pie.html">Pie</a></li>
                <li class="nav-item"><a class="nav-link active" href="./maps_ZIP.html">Maps</a></li>
            </ul>
        </div>
    </div>
</nav>
<h1 style="text-align: center">Memphis Poverty and Race</h1>
<label for="year">Year:</label>
<select id="year" onchange="redrawMap()">
    <option value="2020" selected="selected">2020</option>
    <option value="2021">2021</option>
    <option value="2022">2022</option>
</select>
<!-- Plotly chart will be drawn inside this DIV -->
<div id="myTab" class="tab"></div>
<div id="pMap" class="map"></div>
<div id="rMap" class="map"></div>
<script>
    let fig = []
    let dat = []
    let x = []
    let yp = []
    let yr = []

    Plotly.d3.json('../maps/Shelby_ZCTA.geojson', function (e, f) {
        fig = f
        Plotly.d3.csv("../data/Race_Poverty.csv", function (d) {
            dat = d
            drawMap(dat, fig, '2020')
        })
    })

    function drawMap(d, f, year) {
        var pData = year + '_Poverty';
        var rData = year + '_Race';
        d.forEach((row) => {
            if (row.ZIP !== 'ZIP') {
                x.push(row.ZIP);
                yp.push(row[pData]);
                yr.push(row[rData]);
            }
        })

        var counties1 = [{
            type: 'choropleth',
            geojson: f,
            featureidkey: 'properties.GEOID20',
            locations: x,
            z: yp,
            colorscale: 'Portland',
            colorbar: {
                autotic: false,
                ticksuffix: '%',
                title: 'Poverty Rate'
            }
        }];

        var counties2 = [{
            type: 'choropleth',
            geojson: f,
            featureidkey: 'properties.GEOID20',
            locations: x,
            z: yr,
            colorscale: 'Portland',
            colorbar: {
                autotic: false,
                ticksuffix: '%',
                title: 'Percent Non-White'
            }
        }];

        var table = [{
            type: 'table',
            header: {
                values: [["<b>ZIP</b>"], ["<b>Poverty Rate</b>"],
                    ["<b>Percent Non-White</b>"]],
                align: "center",
                line: {width: 1, color: 'black'},
                fill: {color: "grey"},
                font: {family: "Arial", size: 16, color: "white"}
            },
            cells: {
                values: [x, yp, yr],
                align: "center",
                line: {color: "black", width: 1},
                font: {family: "Arial", size: 12, color: ["black"]}
            }
        }]

        var pMapLayout = {
            title: year + ' Poverty ZIP Code',
            geo: {
                fitbounds: 'locations'
            }
        };

        var rMapLayout = {
            title: year + ' Race ZIP Code',
            geo: {
                fitbounds: 'locations'
            }
        };

        var tabLayout = {
            height: 1000,
            responsive: true
        }

        Plotly.newPlot('pMap', counties1, pMapLayout);
        Plotly.newPlot('rMap', counties2, rMapLayout);
        Plotly.newPlot('myTab', table, tabLayout);

    }

    function redrawMap() {
        x.length = 0
        yp.length = 0
        yr.length = 0
        let year = document.getElementById('year');
        drawMap(dat, fig, year.value);
    }
</script>
<script
        type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.umd.min.js"
></script>
</body>
</html>